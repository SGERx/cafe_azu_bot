# flake8: noqa
from random import choice

from app.schemas.dinnerset_schema import DinnerSetDB

FORMAT_DATE = "%d-%m-%Y"

LEXICON_COMMANDS: dict[str, str] = {
    "/start": "–ü—Ä–∏–≤–µ—Ç—Å–≤–∏–µ –æ—Ç –±–æ—Ç–∞",
    "/add_reservation": "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–∏–∫",
    "/reservations": "–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
    "/help": "–°–ø—Ä–∞–≤–∫–∞ –ø–æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞",
    "/cancel": "–ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è",
}
BUTTON_TEXT: dict[str, str] = {
    "edit_reserv_button": "‚ùå –†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨",
    "add": "üõí –î–æ–±–∞–≤–∏—Ç—å",
    "del": "‚ùå",
    "cancel": "‚ùå –û–¢–ú–ï–ù–ò–¢–¨",
    "back": "‚¨Ö –ù–∞–∑–∞–¥",
    "continue_selection": "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤—ã–±–æ—Ä",
    "description": "üßæ –û–ø–∏—Å–∞–Ω–∏–µ",
    "payment": "üí≥ –û–ø–ª–∞—Ç–∏—Ç—å",
    "another_date": "üìÖ –í—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥—É—é –¥–∞—Ç—É",
    "confirm": "‚úî –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å",
    "add_reservation": "–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å",
    "my_reserv": "–ú–æ–∏ –∑–∞–∫–∞–∑—ã",
    "name_set": "{name} –¶–µ–Ω–∞: {price}",
}

LEXICON_TEXT: dict[str, str] = {
    "/start": (
        "{full_name}, –¥–æ–±—Ä—ã–π –¥–µ–Ω—å!\n\n–Ø –º–æ–≥—É –ø–æ–º–æ—á—å, –í–∞–º, –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–∏–∫ –≤ –æ–¥–Ω–æ–º –∏–∑ –Ω–∞—à–∏—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤.\n"
        "–¢–∞–∫ –∂–µ –º–æ–∂–µ–º –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –µ—Å–ª–∏ —É–∂–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—ã–µ –±—Ä–æ–Ω–∏ –¥–ª—è –í–∞—Å.\n\n"
        "–í–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–æ–π <b>–ú–µ–Ω—é</b> –∏–ª–∏ "
        "–æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É /help"
    ),
    "/help": (
        "–í–æ—Ç —á—Ç–æ —è –≤–∞–º –º–æ–≥—É –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å:\n\n"
        "üü¢ <b>/start</b> - –ü—Ä–∏–≤–µ—Ç—Å–≤–∏–µ –æ—Ç –±–æ—Ç–∞\n"
        "üü¢ <b>/add_reservation</b> - –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–∏–∫\n"
        "üü¢ <b>/reservations</b> - –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è\n"
        "üü¢ <b>/help</b> - –°–ø—Ä–∞–≤–∫–∞ –ø–æ —Ä–∞–±–æ—Ç–µ –±–æ—Ç–∞\n"
        "üü¢ <b>/main_menu</b> - –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é\n"
    ),
    "cancel": (
        "–í—ã –ø—Ä–µ–æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è\n\n"
        "–ß—Ç–æ–±—ã —Å–Ω–æ–≤–∞ –ø–µ—Ä–µ–π—Ç–∏ –∫ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—é –∞–Ω–∫–µ—Ç—ã - "
        "–æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /add_reservation"
    ),
    "/reservations": "–í–æ—Ç —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π:\n\n{reserv}",
    "edit_reserv": "<b>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –±—Ä–æ–Ω—å</b>",
    "no_reserv": "–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ –∑–∞–±—Ä–æ–Ω–∏—Ä—Ä–≤–∞–Ω–æ.\n –ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç—å, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /add_reservation",
    "to_reserv": "–û—Ñ–æ—Ä–º–∏–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ?",
    "fill_name": "–í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–µ –∏–º—è, —á—Ç–æ–±—ã –º—ã –∑–Ω–∞–ª–∏ –∫–∞–∫ –∫ –≤–∞–º –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –≤ —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.",
    "fill_phone": "C–ø–∞—Å–∏–±–æ. –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –¥–ª—è —Å–≤—è–∑–∏",
    "number_of_seats": "–•–æ—Ä–æ—à–æ! –ù–∞–ø–∏—à–∏—Ç–µ –∫–∞–∫–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π –æ–∂–∏–¥–∞—Ç—å?",
    "number_of_seats_correct": "–£—Ç–æ—á–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –µ—â–µ —Ä–∞–∑, —Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç –≥–æ—Å—Ç–µ–π?",
    "fill_restaurant": "–í–æ—Ç —Å–ø–∏—Å–æ–∫ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–æ–≤, –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ —É—é—Ç–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å—Å—è:",
    "change_restaurant": "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω",
    "choose_dish": "–û—Ç–ª–∏—á–Ω–æ! –û—á–µ–Ω—å –ø—Ä–∏—è—Ç–Ω–æ–µ –º–µ—Å—Ç–æ, –∫–æ–º—Ñ–æ—Ä—Ç–Ω–∞—è –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞)\n–î–∞–≤–∞–π—Ç–µ –≤—ã–±–µ—Ä–µ–º –±–ª—é–¥–∞ –Ω–∞ –≤–µ—á–µ—Ä:",
    "add_new_dish": "–ö–∞–∫–æ–µ –µ—â–µ –±–ª—é–¥–æ –¥–æ–±–∞–≤–∏—Ç—å:",
    "num_servings": "–£–∫–∞–∂–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω–æ–≥–æ —Å–µ—Ç–∞:",
    "continue_selection": "–ü—Ä–æ–¥–æ–ª–∂–∏–º –∏–ª–∏ –ø–µ—Ä–µ–π–¥–µ–º –∫ –æ–ø–ª–∞—Ç–µ?",
    "done": "–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ",
    "choice_date": "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–µ—Ç–µ –¥–∞—Ç—É: ",
    "choice_another_date": "–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–∞ —ç—Ç—É –¥–∞—Ç—É –Ω–µ—Ç –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö —Å—Ç–æ–ª–∏–∫–æ–≤.\n –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –∑–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–æ–ª–∏–∫ –Ω–∞ –¥—Ä—É–≥–æ–π –¥–µ–Ω—å?",
    "search_table": "–ò–¥–µ—Ç –ø–æ–∏—Å–∫ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –≤–æ –≤—Å–µ—Ö —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞—Ö",
    "no_answer": "–ö—Å–æ–∂–∞–ª–µ–Ω–∏—é, –Ω–µ –∑–Ω–∞—é –∫–∞–∫ –≤–∞–º –æ—Ç–≤–µ—Ç–∏—Ç—å, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–∑–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –ú–µ–Ω—é –∏–ª–∏ –∫–æ–º–∞–Ω–¥—É /help",
    "confirm": "{order_list}\n\n –≤—Å–µ –≤–µ—Ä–Ω–æ?",
    "payment": "–í—Å–µ –ø—Ä–æ—à–ª–æ —É—Å–ø–µ—à–Ω–æ! –ñ–¥–µ–º –≤–∞—Å —É –Ω–∞—Å –≤ –≥–æ—Å—Ç—è—Ö!",
    "prev_step": [
        "–í—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —à–∞–≥.\n",
        "–ü–æ–ø—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ :)\n",
        "–®–∞–≥ –Ω–∞–∑–∞–¥ –∏ –¥–≤–∞ –≤–ø–µ—Ä–µ–¥ ;)\n",
    ],
    "title_invoice": "–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—ã–π –ó–∞–∫–∞–∑",
    "description_invoice": "–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –ü–æ—Å—Ç–Ω—ã–µ –õ–∞–∫–æ–º—Å—Ç–≤–∞"
}

LEXICON_WARNINGS: dict[str, str] = {
    "fill_name": (
        "–¢–æ, —á—Ç–æ –≤—ã –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ –Ω–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∏–º—è\n\n"
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è\n\n"
        "–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ—Ä–≤–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã - "
        "–æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /cancel"  # todo —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π cancel
    ),
    "fill_phone": (
        "–ù–æ–º–µ—Ä –≤–∞—à–µ–≥–æ —Å–æ—Ç–æ–≤–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º –Ω–∞ —Å–ª—É—á–∞–π —ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ–π —Å–≤—è–∑–∏.\n\n"
        "–í–≤–µ–¥–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤ —Ñ–æ—Ä–º–∞—Ç–µ 8(900) 000-00-00\n"
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑\n\n–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ—Ä–≤–∞—Ç—å "
        "–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /cancel"
    ),
    "choice_date": (
        "–î–∞—Ç–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –ø—Ä–æ—à–µ–¥—à–µ–º –≤—Ä–µ–º–µ–Ω–∏ –∏ –Ω–µ –ø—Ä–µ–≤—ã—à–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–∞.\n\n"
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑\n\n–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ—Ä–≤–∞—Ç—å "
        "–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /cancel"
    ),
    "number_of_seats": (
        "–ü—Ä–æ–≤–µ—Ä—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Ç–æ—á–Ω–æ –Ω–µ—Ç –æ–ø–µ—á–∞—Ç–∫–∏ –∏ –≤—ã –≤–≤–µ–ª–∏ —á–∏—Å–ª–æ. –í–æ–∑–º–æ–∂–Ω–æ —ç—Ç–æ –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–µ —á–∏—Å–ª–æ.\n\n"
        "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑\n\n–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ—Ä–≤–∞—Ç—å "
        "–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /cancel"
    ),
    "fill_restaurant": (
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–∞–º–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞\n\n"
        "–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ—Ä–≤–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ "
        "–∫–æ–º–∞–Ω–¥—É /cancel"
    ),
    "choose_dish": (
        "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –∫–Ω–æ–ø–∫–∞–º–∏ –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –±–ª—é–¥–∞\n\n"
        "–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –ø—Ä–µ—Ä–≤–∞—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∫–µ—Ç—ã - –æ—Ç–ø—Ä–∞–≤—å—Ç–µ "
        "–∫–æ–º–∞–Ω–¥—É /cancel"
    ),
    "tap_name_set": "–ß—Ç–æ–±—ã –≤—ã–±—Ä–∞—Ç—å –±–ª—é–¥–æ, –Ω–∞–∂–º–∏—Ç–µ '–û–ø–∏—Å–∞–Ω–∏–µ' –∏–ª–∏ '–î–æ–±–∞–≤–∏—Ç—å 'üòâ",
    "": "‚è∞ üåò üåö ‚úÖ üîπ üçΩ",
}

RESTAURANTS: dict[str, str] = {
    "kazanmall": "AZU –≤ –¢–¶'KAZANMALL'",
    "it_park": "AZU –Ω–∞ –ü–µ—Ç–µ—Ä–±—É—Ä–≥—Å–∫–æ–π 52 (IT PARK)",
    "republic": "AZU –Ω–∞ –ü–µ—Ç–µ—Ä–±—É—Ä–≥—Å–∫–æ–π 14 (–Ω–∞–ø—Ä–æ—Ç–∏–≤ –¢–¶ '–†–µ—Å–ø—É–±–ª–∏–∫–∞')",
    "decembrites": "AZU –Ω–∞ –î–µ–∫–∞–±—Ä–∏—Å—Ç–æ–≤ 8",
}


def format_order(order: dict) -> str:
    """–§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∏—Ä—É—é—â–∞—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–∫–∞–∑–∞."""

    del order["state_stack"]
    order_result = (
        "<b>–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—ã–π –ó–∞–∫–∞–∑:</b>\n"
        f"- <i>–ò–º—è –ø—Ä–µ–¥–∞–Ω–Ω–æ–≥–æ:</i> {order['name']}\n"
        f"- <i>–°—Ä–µ–¥—Å—Ç–≤–æ —Å–≤—è–∑–∏ –≤–æ –≤—Ä–µ–º—è –ø–æ—Å—Ç–∞:</i> {order['phone']}\n"
        f"- <i>–ü–æ—Å—Ç–Ω–∞—è –¥–∞—Ç–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è:</i> {order['date']}\n"
        f"- <i>–°–æ–æ–±—â–µ—Å—Ç–≤–æ, —Ä–∞–∑–¥–µ–ª—è—é—â–µ–µ —Å–≤—è—â–µ–Ω–Ω—ã–π –ø–æ—Å—Ç:</i> {order['num_people']}\n"
        f"- <i>–ú–µ—Å—Ç–æ –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω–æ–≥–æ –ø–∏—Ä–∞:</i> {order['restaurant']}\n\n"
        "<b>–ò–∑–±—Ä–∞–Ω–Ω—ã–µ –ü–æ—Å—Ç–Ω—ã–µ –õ–∞–∫–æ–º—Å—Ç–≤–∞:</b>\n\n"
    )
    # ! –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
    sets = [
        (DinnerSetDB.model_validate_json(item), count) for item, count in order["sets"]
    ]
    c = 0
    sets = [
        f"‚úî {dish.name} - {dish.description}\n   üü¢ –¶–µ–Ω–∞: {dish.price}üíé   –ö–æ–ª-–≤–æ: {count}\n"
        for dish, count in sets
    ]
    return order_result + ("\n").join(sets)


def format_as_text_list(objects, prefix: str) -> str:
    """ "–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–æ–≤ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Å–ø–∏—Å–æ–∫"""

    text_list = "\n".join(prefix + f"<i>{str(obj)}</i>" for obj in objects)
    return text_list


def get_prev_text(text: str) -> str:
    """
    –§—É–Ω–∫—Ü–∞—è –∏–∑–º–µ–Ω—è—é—â–∞—è –Ω–∞—á–∞–ª–æ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞–∑–∞–¥,
    –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –æ—à–∏–±–∫–∏ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–æ–æ–±—â–µ–Ω–∏–π."""

    prefix = choice(LEXICON_TEXT["prev_step"])
    if "\n" in text:
        text = text.split("\n", maxsplit=1)[1]
    return prefix + text
